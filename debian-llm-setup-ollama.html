
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet/less" type="text/css" href="./theme/stylesheet/style.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>

  <link rel="stylesheet" type="text/css" href="./theme/pygments/friendly.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/font-awesome.min.css">

    <link href="./static/custom.css" rel="stylesheet">

    <link href="https://xingzuoshe.cn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Martin's Blog Atom">


    <link rel="shortcut icon" href="/images/default_profile_200x200.png" type="image/x-icon">
    <link rel="icon" href="/images/default_profile_200x200.png" type="image/x-icon">


    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Martin" />
<meta name="description" content="安装 Ollama 和 open-webui 的步骤" />
<meta name="keywords" content="debian, nvidia">

<meta property="og:site_name" content="Martin's Blog"/>
<meta property="og:title" content="在 debian 12 体验大模型, Ollama 和 open-webui 安装"/>
<meta property="og:description" content="安装 Ollama 和 open-webui 的步骤"/>
<meta property="og:locale" content="zh_CN"/>
<meta property="og:url" content="./debian-llm-setup-ollama.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2024-08-15 22:00:00+08:00"/>
<meta property="article:modified_time" content="2024-08-15 22:00:00+08:00"/>
<meta property="article:author" content="./author/martin.html">
<meta property="article:section" content="Linux"/>
<meta property="article:tag" content="debian"/>
<meta property="article:tag" content="nvidia"/>
<meta property="og:image" content="/images/default_profile_200x200.png">

  <title>Martin's Blog &ndash; 在 debian 12 体验大模型, Ollama 和 open-webui 安装</title>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8640171181637141",
      enable_page_level_ads: true
    });
  </script>
</head>
<body>
  <aside>
    <div>
      <a href=".">
        <img src="/images/default_profile_200x200.png" alt="Martin's Blog" title="Martin's Blog">
      </a>
      <h1><a href=".">Martin's Blog</a></h1>

<p>Martin's Blog</p>
      <nav>
        <ul class="list">
          <li><a href="./pages/about.html#about">About</a></li>

          <li><a href="https://astrohub.cn" target="_blank">astrohub</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="https://github.com/openmartin" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="/blog/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>

      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" crossorigin="anonymous"></script>
      <ins class="adsbygoogle ads-aside"
           style="display:block"
           data-ad-format="auto"
           data-full-width-responsive="true"
           data-ad-client="ca-pub-8640171181637141"
           data-ad-slot="5604848266"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

  </aside>
  <main>

    <nav>
      <a href=".">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://xingzuoshe.cn/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="debian-llm-setup-ollama">在 debian 12 体验大模型, Ollama 和 open-webui 安装</h1>
    <p>
          Posted on 2024-08-15 22:00 in <a href="./category/linux.html">Linux</a>


    </p>
  </header>


  <div>
    <h3>系统设置</h3>
<p>在安装的时候选设置了 root 账号，但是需要把常用的账号加到sudoer列表里，使用起来更方便一点。root 作为特权账号，不适合日常使用。系统操作系统时的注意事项可以参考<a href="./debian-12-with-4060ti.md">上一篇</a></p>
<div class="highlight"><pre><span></span><code>su - root
visudo
</code></pre></div>

<p>在 <code>root ALL=(ALL:ALL) ALL</code> 下面加一行 <code>xxx ALL=(ALL:ALL) ALL</code></p>
<p>一般第一步就是更换镜像源，让下载包的速度更快一点，这里选择腾讯云的镜像，虽然不在官方的镜像列表里，貌似速度快一点</p>
<div class="highlight"><pre><span></span><code><span class="k">deb</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian/</span><span class="w"> </span><span class="kp">bookworm</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>
<span class="k">deb-src</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian/</span><span class="w"> </span><span class="kp">bookworm</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>

<span class="k">deb</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian/</span><span class="w"> </span><span class="kp">bookworm-updates</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>
<span class="k">deb-src</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian/</span><span class="w"> </span><span class="kp">bookworm-updates</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>

<span class="k">deb</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian/</span><span class="w"> </span><span class="kp">bookworm-backports</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>
<span class="k">deb-src</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian/</span><span class="w"> </span><span class="kp">bookworm-backports</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>

<span class="k">deb</span><span class="w"> </span><span class="s">https://mirrors.cloud.tencent.com/debian-security</span><span class="w"> </span><span class="kp">bookworm-security</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>
<span class="k">deb-src</span><span class="w"> </span><span class="s">mirrors.cloud.tencent.com/debian-security</span><span class="w"> </span><span class="kp">bookworm-security</span><span class="w"> </span><span class="kp">main</span><span class="w"> </span><span class="kp">contrib</span><span class="w"> </span><span class="kp">non-free</span><span class="w"> </span><span class="kp">non-free-firmware</span>
</code></pre></div>

<h3>安装 cuda 和 nvidia 驱动</h3>
<p>下载 cuda toolkit, <a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a> </p>
<p>这里使用 runfile 安装</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 先安装 gcc make linux-headers</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-$</span><span class="p">(</span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="p">)</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">developer</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">nvidia</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">compute</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="mf">12.6</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">local_installers</span><span class="o">/</span><span class="n">cuda_12</span><span class="o">.</span><span class="mf">6.0</span><span class="n">_560</span><span class="o">.</span><span class="mf">28.03</span><span class="n">_linux</span><span class="o">.</span><span class="n">run</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">sh</span><span class="w"> </span><span class="n">cuda_12</span><span class="o">.</span><span class="mf">6.0</span><span class="n">_560</span><span class="o">.</span><span class="mf">28.03</span><span class="n">_linux</span><span class="o">.</span><span class="n">run</span>
</code></pre></div>

<p>安装失败了，查看日志发现出现下面的错误</p>
<div class="highlight"><pre><span></span><code><span class="o">-&gt;</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="s">&#39;/tmp/.X0-lock&#39;</span><span class="w"> </span><span class="nf">exists</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">process</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="s">&#39;1680&#39;</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="n">server</span><span class="p">.</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w">  </span><span class="n">Installing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NVIDIA</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="n">while</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="kr">not</span><span class="w"> </span><span class="n">recommended</span><span class="p">,</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">doing</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">installer</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">detecting</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">installation</span><span class="w"> </span><span class="n">problems</span><span class="p">,</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="kr">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">graphics</span><span class="w"> </span><span class="n">applications</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">installed</span><span class="p">.</span><span class="w">  </span><span class="nf">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="nf">choose</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">continue</span><span class="w"> </span><span class="n">installation</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">highly</span><span class="w"> </span><span class="n">recommended</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">reboot</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">computer</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">installation</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">newly</span><span class="w"> </span><span class="n">installed</span><span class="w"> </span><span class="n">driver</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Answer</span><span class="o">:</span><span class="w"> </span><span class="n">Abort</span><span class="w"> </span><span class="n">installation</span><span class="p">)</span>
</code></pre></div>

<p>停止 xorg 进程之后再重新安装 cuda 试试</p>
<div class="highlight"><pre><span></span><code>ps -ef | grep xorg
# 看使用的是什么图形管理器，常见的有 gdm3/kdm/lightdm/sddm
sudo /etc/init.d/lightdm stop
</code></pre></div>

<p>出现了下面的输出说明安装成功了</p>
<div class="highlight"><pre><span></span><code><span class="gh">===========</span>
<span class="gh">= Summary =</span>
<span class="gh">===========</span>

Driver:   Installed
Toolkit:  Installed in /usr/local/cuda-12.6/

Please make sure that
 -   PATH includes /usr/local/cuda-12.6/bin
 <span class="m">-</span>   LD_LIBRARY_PATH includes /usr/local/cuda-12.6/lib64, or, add /usr/local/cuda-12.6/lib64 to /etc/ld.so.conf and run ldconfig as root

To uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-12.6/bin
To uninstall the NVIDIA Driver, run nvidia-uninstall
Logfile is /var/log/cuda-installer.log
</code></pre></div>

<p><code>nvidia-smi</code> 输出下面的界面，说明找到了显卡</p>
<div class="highlight"><pre><span></span><code><span class="nb">+-----------------------------------------------------------------------------------------+</span>
<span class="c">| NVIDIA</span><span class="nb">-</span><span class="c">SMI 560</span><span class="nt">.</span><span class="c">28</span><span class="nt">.</span><span class="c">03              Driver Version: 560</span><span class="nt">.</span><span class="c">28</span><span class="nt">.</span><span class="c">03      CUDA Version: 12</span><span class="nt">.</span><span class="c">6     |</span>
<span class="c">|</span><span class="nb">-----------------------------------------+------------------------+----------------------+</span>
<span class="c">| GPU  Name                 Persistence</span><span class="nb">-</span><span class="c">M | Bus</span><span class="nb">-</span><span class="c">Id          Disp</span><span class="nt">.</span><span class="c">A | Volatile Uncorr</span><span class="nt">.</span><span class="c"> ECC |</span>
<span class="c">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory</span><span class="nb">-</span><span class="c">Usage | GPU</span><span class="nb">-</span><span class="c">Util  Compute M</span><span class="nt">.</span><span class="c"> |</span>
<span class="c">|                                         |                        |               MIG M</span><span class="nt">.</span><span class="c"> |</span>
<span class="c">|=========================================</span><span class="nb">+</span><span class="c">========================</span><span class="nb">+</span><span class="c">======================|</span>
<span class="c">|   0  NVIDIA GeForce RTX 4060 Ti     Off |   00000000:26:00</span><span class="nt">.</span><span class="c">0 Off |                  N/A |</span>
<span class="c">| 30%   39C    P0             21W /  165W |       1MiB /  16380MiB |      0%      Default |</span>
<span class="c">|                                         |                        |                  N/A |</span>
<span class="nb">+-----------------------------------------+------------------------+----------------------+</span>

<span class="nb">+-----------------------------------------------------------------------------------------+</span>
<span class="c">| Processes:                                                                              |</span>
<span class="c">|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |</span>
<span class="c">|        ID   ID                                                               Usage      |</span>
<span class="c">|=========================================================================================|</span>
<span class="c">|  No running processes found                                                             |</span>
<span class="nb">+-----------------------------------------------------------------------------------------+</span>
</code></pre></div>

<h3>安装 docker</h3>
<p><a href="https://docs.docker.com/engine/install/debian/">https://docs.docker.com/engine/install/debian/</a> 参考官方的安装办法，这里使用 deb 包手动安装。</p>
<p>因为被墙了，所以需要一些上网魔法，<code>export https_proxy=http://example.com:8080</code></p>
<div class="highlight"><pre><span></span><code><span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">dists</span><span class="o">/</span><span class="n">bookworm</span><span class="o">/</span><span class="n">pool</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">containerd</span><span class="o">.</span><span class="n">io_1</span><span class="o">.</span><span class="mf">7.20</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">dists</span><span class="o">/</span><span class="n">bookworm</span><span class="o">/</span><span class="n">pool</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce_27</span><span class="o">.</span><span class="mf">1.2</span><span class="o">-</span><span class="mi">1</span><span class="o">~</span><span class="n">debian</span><span class="o">.</span><span class="mi">12</span><span class="o">~</span><span class="n">bookworm_amd64</span><span class="o">.</span><span class="n">deb</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">dists</span><span class="o">/</span><span class="n">bookworm</span><span class="o">/</span><span class="n">pool</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli_27</span><span class="o">.</span><span class="mf">1.2</span><span class="o">-</span><span class="mi">1</span><span class="o">~</span><span class="n">debian</span><span class="o">.</span><span class="mi">12</span><span class="o">~</span><span class="n">bookworm_amd64</span><span class="o">.</span><span class="n">deb</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">dists</span><span class="o">/</span><span class="n">bookworm</span><span class="o">/</span><span class="n">pool</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">buildx</span><span class="o">-</span><span class="n">plugin_0</span><span class="o">.</span><span class="mf">16.2</span><span class="o">-</span><span class="mi">1</span><span class="o">~</span><span class="n">debian</span><span class="o">.</span><span class="mi">12</span><span class="o">~</span><span class="n">bookworm_amd64</span><span class="o">.</span><span class="n">deb</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">dists</span><span class="o">/</span><span class="n">bookworm</span><span class="o">/</span><span class="n">pool</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">plugin_2</span><span class="o">.</span><span class="mf">29.1</span><span class="o">-</span><span class="mi">1</span><span class="o">~</span><span class="n">debian</span><span class="o">.</span><span class="mi">12</span><span class="o">~</span><span class="n">bookworm_amd64</span><span class="o">.</span><span class="n">deb</span>
</code></pre></div>

<p>安装下载的 deb 包</p>
<div class="highlight"><pre><span></span><code>sudo dpkg -i *.deb
</code></pre></div>

<p>可能会出现缺少依赖的问题</p>
<div class="highlight"><pre><span></span><code><span class="nx">Setting</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="nx">docker</span><span class="o">-</span><span class="nx">buildx</span><span class="o">-</span><span class="nx">plugin</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">0.16.2</span><span class="o">-</span><span class="mi">1</span><span class="o">~</span><span class="nx">debian</span><span class="m m-Double">.12</span><span class="o">~</span><span class="nx">bookworm</span><span class="p">)</span><span class="w"> </span><span class="o">...</span>
<span class="nx">dpkg</span><span class="p">:</span><span class="w"> </span><span class="nx">dependency</span><span class="w"> </span><span class="nx">problems</span><span class="w"> </span><span class="nx">prevent</span><span class="w"> </span><span class="nx">configuration</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">docker</span><span class="o">-</span><span class="nx">ce</span><span class="p">:</span>
<span class="w"> </span><span class="nx">docker</span><span class="o">-</span><span class="nx">ce</span><span class="w"> </span><span class="nx">depends</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">iptables</span><span class="p">;</span><span class="w"> </span><span class="nx">however</span><span class="p">:</span>
<span class="w">  </span><span class="nx">Package</span><span class="w"> </span><span class="nx">iptables</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">installed</span><span class="p">.</span>

<span class="nx">dpkg</span><span class="p">:</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">processing</span><span class="w"> </span><span class="kn">package</span><span class="w"> </span><span class="nx">docker</span><span class="o">-</span><span class="nx">ce</span><span class="w"> </span><span class="p">(</span><span class="o">--</span><span class="nx">install</span><span class="p">):</span>
</code></pre></div>

<p>执行下面的方法修复，会安装 iptables libip6tc2，然后再 dpkg 重新安装一下</p>
<div class="highlight"><pre><span></span><code>sudo apt --fix-broken
</code></pre></div>

<p>验证一下，需要配置一下 docker 镜像来加速，可以用赛博菩萨 cloudflare.com 的服务免费搭一个 docker 镜像，网上有很多教程</p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/docker/daemon.json
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;registry-mirrors&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s">&quot;http://docker.自己去搭.cn&quot;</span>
<span class="w">    </span><span class="p">]</span>

<span class="p">}</span>
</code></pre></div>

<p>拉取 hello-world 镜像验证一下是否成功</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
<span class="n">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="s1">&#39;hello-world:latest&#39;</span><span class="w"> </span><span class="n">locally</span>
<span class="n">latest</span><span class="p">:</span><span class="w"> </span><span class="n">Pulling</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">library</span><span class="o">/</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
<span class="n">c1ec31eb5944</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">Digest</span><span class="p">:</span><span class="w"> </span><span class="n">sha256</span><span class="p">:</span><span class="mi">53</span><span class="n">cc4d415d839c98be39331c948609b659ed725170ad2ca8eb36951288f81b75</span>
<span class="n">Status</span><span class="p">:</span><span class="w"> </span><span class="n">Downloaded</span><span class="w"> </span><span class="n">newer</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">hello</span><span class="o">-</span><span class="n">world</span><span class="p">:</span><span class="n">latest</span>

<span class="n">Hello</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Docker</span><span class="o">!</span>
<span class="n">This</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">shows</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">installation</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">correctly</span><span class="o">.</span>

<span class="n">To</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">steps</span><span class="p">:</span>
<span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">contacted</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">daemon</span><span class="o">.</span>
<span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">daemon</span><span class="w"> </span><span class="n">pulled</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">&quot;hello-world&quot;</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">Hub</span><span class="o">.</span>
<span class="w">    </span><span class="p">(</span><span class="n">amd64</span><span class="p">)</span>
<span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">daemon</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">the</span>
<span class="w">    </span><span class="n">executable</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">currently</span><span class="w"> </span><span class="n">reading</span><span class="o">.</span>
<span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">daemon</span><span class="w"> </span><span class="n">streamed</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">it</span>
<span class="w">    </span><span class="n">to</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">terminal</span><span class="o">.</span>

<span class="n">To</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">ambitious</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">Ubuntu</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="n">with</span><span class="p">:</span>
<span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">it</span><span class="w"> </span><span class="n">ubuntu</span><span class="w"> </span><span class="n">bash</span>

<span class="n">Share</span><span class="w"> </span><span class="n">images</span><span class="p">,</span><span class="w"> </span><span class="n">automate</span><span class="w"> </span><span class="n">workflows</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">Docker</span><span class="w"> </span><span class="n">ID</span><span class="p">:</span>
<span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">hub</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">examples</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">ideas</span><span class="p">,</span><span class="w"> </span><span class="n">visit</span><span class="p">:</span>
<span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="n">started</span><span class="o">/</span>
</code></pre></div>

<p>下面的命令让用户不使用 sudo 也可以操作 docker，使用起来更方便</p>
<div class="highlight"><pre><span></span><code>sudo usermod -aG docker $USER
newgrp docker
</code></pre></div>

<h4>安装 NVIDIA Container Toolkit</h4>
<p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">NVIDIA Container Toolkit</a> </p>
<p>下载 deb 的地址 <a href="https://github.com/NVIDIA/nvidia-container-toolkit/releases">https://github.com/NVIDIA/nvidia-container-toolkit/releases</a></p>
<div class="highlight"><pre><span></span><code><span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">zxvf</span><span class="w"> </span><span class="n">nvidia</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">toolkit_1</span><span class="o">.</span><span class="mf">16.1</span><span class="n">_deb_amd64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">cd</span><span class="w"> </span><span class="n">release</span><span class="o">-</span><span class="n">v1</span><span class="o">.</span><span class="mf">16.1</span><span class="o">-</span><span class="n">stable</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="w"> </span>
<span class="n">sudo</span><span class="w"> </span><span class="n">dpkg</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="o">*.</span><span class="n">deb</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">nvidia</span><span class="o">-</span><span class="n">ctk</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="o">--</span><span class="n">runtime</span><span class="o">=</span><span class="n">docker</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">systemctl</span><span class="w"> </span><span class="n">restart</span><span class="w"> </span><span class="n">docker</span>
</code></pre></div>

<p>安装完成之后，在 docker 中运行的程序也可以使用 GPU</p>
<h3>Installing Ollama</h3>
<p>去官网下载 <a href="https://ollama.com/">https://ollama.com/</a></p>
<div class="highlight"><pre><span></span><code>curl -fsSL https://ollama.com/install.sh | sh
</code></pre></div>

<p>推荐试试这几个模型，这也是 continue.dev 这个 AI 编程插件推荐的</p>
<div class="highlight"><pre><span></span><code>ollama run llama3.1:8b
ollama run deepseek-coder-v2:16b
ollama pull nomic-embed-text
</code></pre></div>

<h3>Install open-webui</h3>
<p>可以使用docker</p>
<div class="highlight"><pre><span></span><code>sudo docker pull ghcr.io/open-webui/open-webui:cuda
</code></pre></div>

<p>也可以直接安装 <code>pip install open-webui</code>，后者的可控性更强一点</p>
<div class="highlight"><pre><span></span><code>python3 -m venv open_webui_venv
pip install open-webui
</code></pre></div>

<p>依赖的包很多，等待下载完需要一段时间</p>
<p>一个人可以不开启用户管理，直接是一个对话界面，下面是启动脚本</p>
<div class="highlight"><pre><span></span><code><span class="c1"># start.sh</span>
<span class="n">source</span><span class="w"> </span><span class="o">~/</span><span class="n">open_webui_venv</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="k">export</span><span class="w"> </span><span class="n">WEBUI_AUTH</span><span class="o">=</span><span class="n">False</span>
<span class="k">export</span><span class="w"> </span><span class="n">HF_ENDPOINT</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">hf</span><span class="o">-</span><span class="n">mirror</span><span class="o">.</span><span class="n">com</span>
<span class="n">nohup</span><span class="w"> </span><span class="n">open</span><span class="o">-</span><span class="n">webui</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">&amp;</span>
</code></pre></div>

<p>最后打开的界面如下，非常简洁</p>
<p><img alt="open-webui" src="../images/open-webui.png"></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/debian.html">debian</a>
      <a href="./tag/nvidia.html">nvidia</a>
    </p>
  </div>




    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" crossorigin="anonymous"></script>
    <ins class="adsbygoogle ads-responsive"
         style="display:block"
         data-ad-format="auto"
         data-full-width-responsive="true"
         data-ad-client="ca-pub-8640171181637141"
         data-ad-slot="4393383534"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'astro-2';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  2025</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Martin's Blog ",
  "url" : ".",
  "image": "/images/default_profile_200x200.png",
  "description": "Martin's Thoughts and Writings"
}
</script>

</body>
</html>